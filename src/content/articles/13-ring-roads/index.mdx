---
title: "One ring (road) to rule them all!"
summary: "Which Belgian ring road is the most circular, and hence the best one? An excessive analysis of Belgian ring roads no one asked for."
date: "12/28/2025"
draft: false
tags:
- Cartograpy
- Interactive
---

import RoadLabel from "../../../components/RoadLabel.astro"
import Definition from "../../../components/Definition.astro"
import Figure from "../../../components/Figure.astro"

## Introduction
Which Belgian ring road is the best ring? To answer this question, we first need to define what a ring road is:

<Definition 
    term="ring road"
    partOfSpeech="noun"
    pronunciation="/rĭng roʊd/"
    definitions={[
        { number: 1, text: "A circumferential highway around a town, city, or other conurbation." },
        { number: 2, text: "A highway that encircles an urban area so that traffic does not have to pass through the center.", example: "The Brussels Ring Road handles over 20 vehicles daily." }
    ]}
/>

In our case, let's call **all**, and **only**, roads that are referred to with an **R-number** a ring road. 
This excludes several national roads, such as the <RoadLabel label="N" number="712"/> around Pelt, which shows promising ring-like characteristics. 
If a road is not deemed impressive or important enough to warrant an R-number, it is certainly not impressive enough to be called the _ringiest_ Belgian ring road.  
Some ring roads were planned but ultimately failed to come to fruition. A notable example is the <RoadLabel label="R" number="7"/> around Liège, 
which was planned to be formed by the unfinished <RoadLabel label="A" number="604"/>, the <RoadLabel label="E" number="42"/>, the <RoadLabel label="E" number="25"/>, and the planned but cancelled <RoadLabel label="A" number="605"/>.

The ring roads are numbered in categories:
- <RoadLabel label="R" number="1"/>-<RoadLabel label="R" number="9"/> around principal cities, 
- <RoadLabel label="R" number="10"/>-<RoadLabel label="R" number="19"/> in Antwerp,
- <RoadLabel label="R" number="20"/>-<RoadLabel label="R" number="29"/> in Brabant (Flemish and Walloon),
- <RoadLabel label="R" number="30"/>-<RoadLabel label="R" number="39"/> in West Flanders, 
- <RoadLabel label="R" number="40"/>-<RoadLabel label="R" number="49"/> in East Flanders,
- <RoadLabel label="R" number="50"/>-<RoadLabel label="R" number="59"/> in Hainaut, 
- <RoadLabel label="R" number="60"/>-<RoadLabel label="R" number="69"/> in Liège, 
- <RoadLabel label="R" number="70"/>-<RoadLabel label="R" number="79"/> in Limburg.

The name _"ring road"_ implies two properties of such roads: they are _ringlike_, and they are roads.  
The latter property is trivially satisfied by our definition above, so let's focus on the former:

<Definition
    term="ring" 
    partOfSpeech="noun" 
    pronunciation="/rĭng/"
    definitions={[
        { number: 1, text: "A circular object, form, line, or arrangement. " },
        { number: 2, text: "A small circular band, generally made of precious metal and often set with jewels, worn on the finger." },
        { number: 3, text: "A circular band used for carrying, holding, or containing something. ", example: "a wedding ring." }
    ]}
/>

Let's define a ring as **circular** and **closed**. 
The latter of these properties is a tad more flexible than the former, as an open ring is quite common, 
both in road infrastructure and in other _ringlike_ objects (e.g., a Celtic torc).
The best ring road is hence the one that is the most circular while being reasonably closed.

As the problem is now clearly defined, we can focus on finding the solution. 
The next section will explain the method that was selected to evaluate the circularity, [or you can skip straight to the interactive visualization of the results](#results-and-conclusion).

## Method
The evaluation process consists of several steps:
1. **Data acquisition** from [OpenStreetMap](https://www.openstreetmap.org/#map=14/50.87997/4.70738),
2. **Rasterization** of the vector-formatted roads,
3. **Circle fitting** using RANSAC,
4. **Evaluation** of the circularity of the ring roads.

To facilitate the interpretation of the presented method, every step is illustrated with figures taken in between important steps. The ring road <RoadLabel label="R" number="23"/> around Leuven is selected as an example in a chauvinistic homage to my alma mater. 

### Data acquisition
#### Getting GeoJSON road data
Road data is acquired from OpenStreetMap using the [Overpass API](https://wiki.openstreetmap.org/wiki/Overpass_API).
The query given below is sent in the body of a `POST` request to the Overpass API. The response is a JSON object containing the relevant elements (including ways, traffic signals, zebra crossings, ...).  
For this article, only the ways are relevant, but it is nonetheless interesting to know that <RoadLabel label="R" number="23"/> contains **71** traffic lights and **32** zebra crossings (according to the Overpass query). 
The ring road with the most traffic signals is <RoadLabel label="R" number="22"/> with **228** signals. The same road, <RoadLabel label="R" number="22"/>, has the most zebra crossings, with a respectable **101** crossings. 
The ring roads with the least amount of signals are those that consist of only highways, such as <RoadLabel label="R" number="0"/>. Brussels wins across the board! 
```javascript
// Set output format and timeout
[out:json][timeout:60];                         
// Get country area for filtering
area["ISO3166-1"="BE"]->.country;
// Union '(...)' combines queries into one
(
// Search ways in Belgium where "ref" matches R23
way(area.country)["highway"]["ref"="R23"];      
// Search groups of ways where "ref" matches R23
relation(area.country)["highway"]["ref"="R23"]; 
);
// Recursively fetch all nodes in the previous query
(._;>;);                                        
// Output the fetched data
out body;                                       
```

#### Transforming the fetched data
The ways in the Overpass response are in the **GeoJSON** format, with coordinates in **WGS84** format (longitude and latitude). 
They are converted to local distances to the geometric center of the road using an **equirectangular approximation** of the sphere, which is accurate enough for the small distances in this work.  
Evaluation in local distances is necessary to avoid distortions, as the Earth is **not** flat. 
Local distances are anyway how we normally think of the world and are how most mapping applications represent the world.

<Figure
    src="/ring-roads/road_R23_BE_fetched.png"
    alt="Visualization of the transformation of the WGS84 coordinates into local kilometers to more intuitively represent the roads."
/>

### Rasterization
Because the road data is in vector format, it needs to be rasterized to avoid bias towards roads with more data points.
The vector lines representing roads are rasterized using **Bresenham's line algorithm** to a black and white image using a constant pixel size. Each pixel corresponds to a **5x5 m** square on the map. 
The image size is chosen to fit the entire road within. The black and white image is called a **mask** and indicates the presence (**white**) or absence (**black**) of a road.    
Next, the rasterized image is **dilated 32.5 m** (kernel size 13 px) to ensure that the road is continuous, as every road has an initial thickness of 1 pixel. 
Some roads, furthermore, have gaps due to missing data in the OpenStreetMap response (e.g., overpasses or crossings). Some roads have wider lanes, a wide median, or multiple lanes, which are all part of the same road and result in multiple parallel-ish lines.  
The mask is finally **eroded 22.5 m** (kernel size 9 px) to give some width to the road, as the initial rasterized image is only one pixel or 5 m wide. The final road width is hence at least **20 m**.  
The figure below shows the intermediary road masks after every step. The algorithms that were used are quite common in computer vision and image processing and are readily available in the [`python-opencv`](https://pypi.org/project/opencv-python/) library. The rasterization process is given below the figure in simplified Python code.

<Figure
    src="/ring-roads/road_R23_BE_mask_rendering.png"
    alt="Visualization of the rasterization of ring road R23 (Leuven) showing the steps from vector data to rasterized image."
/>

``` python
import numpy as np
import cv2

def rasterize_road(local_lines):
    # Rasterize the list of vector lines from OpenStreetMap
    mask = Bresenham(local_lines, pixel_size=5)
    # Pad the mask with 20 black pixels on every side to avoid edge effects
    mask = np.pad(mask, pad_width=20, mode='constant', constant_values=0)
    # Dilate with kernel size 13x13 (65x65 m)
    mask = cv2.dilate(mask.astype(np.float32), np.ones((13,13), np.uint8))
    # Erode with kernel size 9x9 (45x45 m)
    mask = cv2.erode(mask.astype(np.float32), np.ones((9,9), np.uint8))
    # Remove padding
    mask = mask[20:-20, 20:-20]

    return mask
```

### Circle fitting
To evaluate the circularity of the ring roads, we can now look for the circle that best conforms to the rasterized road. Since we are certain there is exactly **one** *circle* in the mask, a simple stochastic evaluation algorithm is sufficient.  
The **RANSAC** (RANdom SAmple and Consensus) algorithm is a tried and tested method in computer vision to find shapes in images. It tries a large number of random circles, tests their match to the sample data, and takes the circle that fits the data best. 

#### Evaluating a random circle

The **RANSAC** estimator evaluates the fit by looking at which points fall within a certain margin from the tried circle, but because we are not looking for perfect circles, this margin needs to be chosen quite wide (**400 m**) to provide plausible results.  
Every point that lies further than **400 m** from the tried circle is included in the cost equally. Since the margin is quite large, there are many solutions, which include all points, which can be clearly seen in the figure below. 
To increase the robustness of the circle fitting algorithm, an alternative M-estimator (**MSAC**) is chosen as the cost function, in which the cost increases with distance to the circle **squared** up to a maximum of **400&nbsp;m**. 
In contrast to the RANSAC estimator, MSAC can provide a **best**-fitting circle given enough iterations.  
The circle with the minimum cost is deemed the best fit and is used for further processing.
The difference in cost evaluation between the **RANSAC** and **MSAC** is shown in the figure below.

<Figure
    src="/ring-roads/R23_cost_function_comparison_80.0.png"
    alt="Difference between the RANSAC and MSAC cost evaluation function visualized for R23."
/>


#### Evaluating many circles and finding the best fit
By evaluating many random samples and comparing every circle to the previous best fit, the best-fitting circle is found given enough iterations. The next two figures visualize the sampling and evaluation process as a plot showing the reduction in cost after every iteration and visually applied on ring road <RoadLabel label="R" number="23"/>.

<Figure
    src="/ring-roads/R23_circle_fit_costs_80.0_msac.png"
    alt="A plot showing the cost of every circle fit on R23 evaluated using the MSAC estimator and the running tally of the best-fitting circle's cost. The x-axis shows the iterations where a new best fit is found."
/>


<Figure
    src="/ring-roads/R23_circle_fit_animation_80.0_msac.mp4"
    alt="Animation of the MSAC fitting process applied visually on R23."
    darkmode={false}
/>

### Evaluation of the ring roads
To determine the *ringiest* ring road, we need some parameters to compare.

#### Root mean square (RMS) error
The root mean square error can be calculated from the distances from every point to the nearest point on the fitted circle. This distance is quite straightforward to calculate due to the properties of a circle. The line from the sample point to the center of the circle crosses the nearest point, located one radius from the center.  

$$
d(x,y) = \sqrt{(x - C(x))^2 + (y - C(y))^2} - R
$$

Where $R$ is the radius of the best-fitting circle, and $C(x)$ and $C(y)$ are the coordinates of its center. The RMS error can then be calculated as

$$
RMS = \sqrt{\frac{1}{n}\sum_{i}^{n}{d_i^2}}
$$

A problem with the RMS error is that it favours smaller ring roads. Normalizing the RMS error to the circle radius $R$ is a better indication of the circularity.

$$
RMS_{normalized} = \frac{RMS}{R}
$$

#### Distance from city center
The distance to the city is calculated using the Pythagorean Theorem to the administrative center according to OpenStreetMap. The city centers are indicated with a location pin in the result section below.


#### Closed fraction
Not all ring roads form closed loops. To evaluate the *closure* of the ring roads with respect to the fitted circle, an array of uniformly spaced rays is cast outward from the city center. Every time a ray hits a white pixel (road presence in the mask), it is registered as a hit. The percentage of closure can then be calculated using

$$
Closure = \frac{hits}{n_{rays}} \cdot 100\%
$$

## Results and conclusion

To avoid bias, the initial order is set to the R-number while showing all ring roads. Select a closure percentage to filter ring-like roads (80% seems a good cut-off) and select sorting methods to your liking.

import Roads from "Roads.astro"

<Roads/>

## Discussion

(Paragraph work in progress)
This review contains only ring roads labeled with an R-number. A possible extension is to add selected provincial roads as they sometimes act as a ring road. 
<RoadLabel label="N" number="712"/> is a straightforward example, as it is a single road that runs around the town of Pelt.  
Not all provincial ring roads are that neatly organized. <RoadLabel label="N" number="7"/> in Ath, for instance, is a longer road that passes Ath and acts as a ring road for a small fraction of its length. It is hence difficult to separate the ring part of the road. 
Another complication is that some informal ring roads use parts of multiple roads to form a ring-like road around a city or town.
The unofficial ring road around Dendermonde, for instance, consists of parts of roads <RoadLabel label="N" number="17"/>, <RoadLabel label="N" number="41"/>, and <RoadLabel label="N" number="47"/>.
